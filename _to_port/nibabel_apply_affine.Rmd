---
jupyter:
  jupytext:
    text_representation:
      extension: .Rmd
      format_name: rmarkdown
      format_version: '1.2'
      jupytext_version: 1.11.5
---

$\newcommand{L}[1]{\| #1 \|}\newcommand{VL}[1]{\L{ \vec{#1} }}\newcommand{R}[1]{\operatorname{Re}\,(#1)}\newcommand{I}[1]{\operatorname{Im}\, (#1)}$

## Applying coordinate transforms with `nibabel.affines.apply_affine`

We often want to apply an affine to an array of coordinates, where the last
axis of the array is length 3, containing the x, y and z coordinates.

Nibabel uses `nibabel.affines.apply_affine` for this.

For background see: The nibabel.affines module.

```{python}
import numpy as np
from nibabel.affines import from_matvec, to_matvec, apply_affine
```

```{python}
points = np.array([[0, 1, 2], [2, 2, 4], [3, -2, 1], [5, 3, 1]])
points
```

```{python}
zooms_plus_translations = from_matvec(np.diag([3, 4, 5]),
                                      [11, 12, 13])
zooms_plus_translations
```

```{python}
apply_affine(zooms_plus_translations, points)
```

Of course, this is the same as:

```{python}
mat, vec = to_matvec(zooms_plus_translations)
mat.dot(points.T).T + vec.reshape((1, 3))
```

The advantage of `nib.affines.apply_affine` is that it can deal with arrays
of more than two dimensions, and it transposes the transformation matrices for
you to apply the transforms correctly.

A typical use is when applying extra affine transformations to a X by Y by Z
by 3 array of coordinates.

<!-- vim:ft=rst -->
<!-- Course -->
<!-- BIC -->
<!-- Python distributions -->
<!-- Version control -->
<!-- Editors -->
<!-- Python and common libraries -->
<!-- IPython -->
<!-- Virtualenv and helpers -->
<!-- Pypi and packaging -->
<!-- Mac development -->
<!-- Windows development -->
<!-- Nipy and friends -->
<!-- FMRI datasets -->
<!-- Languages -->
<!-- Imaging software -->
<!-- Installation -->
<!-- Tutorials -->
<!-- MB tutorials -->
<!-- Ideas -->
<!-- Psych-214 -->
<!-- People -->
<!-- Licenses -->
<!-- Neuroimaging stuff -->
<!-- OpenFMRI projects -->
<!-- Unix -->
<!-- Substitutions -->
